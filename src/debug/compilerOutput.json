[
  {
    "level": "info",
    "message": "Lexer output (tokens) ",
    "timestamp": "2026-01-23T03:10:55.357Z",
    "context": [
      {
        "type": "KEYWORD",
        "value": "when",
        "line": 1,
        "column": 1
      },
      {
        "type": "IDENTIFIER",
        "value": "flagClicked",
        "line": 1,
        "column": 6
      },
      {
        "type": "NEWLINE",
        "value": "\n",
        "line": 1,
        "column": 16
      },
      {
        "type": "INDENT",
        "value": "  ",
        "line": 2,
        "column": 1
      },
      {
        "type": "KEYWORD",
        "value": "say",
        "line": 2,
        "column": 3
      },
      {
        "type": "STRING",
        "value": "hi",
        "line": 2,
        "column": 9
      },
      {
        "type": "NEWLINE",
        "value": "\n",
        "line": 2,
        "column": 10
      },
      {
        "type": "DEDENT",
        "value": "",
        "line": 3,
        "column": 1
      },
      {
        "type": "EOF",
        "value": "",
        "line": 3,
        "column": 1
      }
    ]
  },
  {
    "level": "info",
    "message": "Parser output (program) ",
    "timestamp": "2026-01-23T03:10:55.357Z",
    "context": {
      "scripts": [
        {
          "blocks": [
            {
              "type": "event",
              "name": "when",
              "args": [
                "flagClicked"
              ],
              "next": {
                "type": "looks",
                "name": "say",
                "args": [
                  "hi"
                ]
              }
            }
          ]
        }
      ],
      "variables": {},
      "lists": {}
    }
  },
  {
    "level": "info",
    "message": "Generator output (jsCode) ",
    "timestamp": "2026-01-23T03:10:55.358Z",
    "context": {
      "js": "// Generated Scratch-like JavaScript code\n// Runtime support functions\nconst scratchRuntime = {\n    sprites: {},\n    stage: { width: 480, height: 360, backgroundColor: 'white' },\n    currentSprite: 'Sprite1',\n    variables: {},\n    lists: {},\n    procedures: {},\n    events: {},\n    greenFlagHandlers: [],\n    answer: '',\n    broadcasts: {},\n    running: false,\n\n    // Initialize the default sprite\n    initSprite: function(name) {\n        this.sprites[name] = {\n            x: 0,\n            y: 0,\n            direction: 90,\n            visible: true,\n            size: 100,\n            move: function(steps) {\n                const radians = (this.direction - 90) * Math.PI / 180;\n                this.x += steps * Math.cos(radians);\n                this.y -= steps * Math.sin(radians);\n                scratchRuntime.updateSpritePosition(name);\n            },\n            turnRight: function(degrees) {\n                this.direction = (this.direction + degrees) % 360;\n                scratchRuntime.updateSpriteRotation(name);\n            },\n            turnLeft: function(degrees) {\n                this.direction = (this.direction - degrees + 360) % 360;\n                scratchRuntime.updateSpriteRotation(name);\n            },\n            pointInDirection: function(dir) {\n                this.direction = dir % 360;\n                if (this.direction < 0) this.direction += 360;\n                scratchRuntime.updateSpriteRotation(name);\n            },\n            goTo: function(x, y) {\n                this.x = x;\n                this.y = y;\n                scratchRuntime.updateSpritePosition(name);\n            },\n            setX: function(x) {\n                this.x = x;\n                scratchRuntime.updateSpritePosition(name);\n            },\n            setY: function(y) {\n                this.y = y;\n                scratchRuntime.updateSpritePosition(name);\n            },\n            changeX: function(dx) {\n                this.x += dx;\n                scratchRuntime.updateSpritePosition(name);\n            },\n            changeY: function(dy) {\n                this.y += dy;\n                scratchRuntime.updateSpritePosition(name);\n            },\n            hide: function() {\n                this.visible = false;\n                const spriteDiv = document.getElementById('sprite-' + name);\n                if (spriteDiv) spriteDiv.style.display = 'none';\n            },\n            show: function() {\n                this.visible = true;\n                const spriteDiv = document.getElementById('sprite-' + name);\n                if (spriteDiv) spriteDiv.style.display = 'block';\n            },\n            setSize: function(size) {\n                this.size = size;\n                scratchRuntime.updateSpriteSize(name);\n            },\n            changeSize: function(change) {\n                this.size += change;\n                scratchRuntime.updateSpriteSize(name);\n            },\n            say: function(message, seconds) {\n                scratchRuntime.showSpeechBubble(name, message, seconds);\n            },\n            think: function(message, seconds) {\n                scratchRuntime.showSpeechBubble(name, message, seconds, true);\n            }\n        };\n    },\n\n    // Update sprite position in DOM\n    updateSpritePosition: function(name) {\n        const sprite = this.sprites[name];\n        const spriteDiv = document.getElementById('sprite-' + name);\n        if (spriteDiv && sprite) {\n            spriteDiv.style.left = (sprite.x + this.stage.width/2 - 15) + 'px';\n            spriteDiv.style.bottom = (sprite.y + this.stage.height/2 - 15) + 'px';\n        }\n    },\n\n    // Update sprite rotation in DOM\n    updateSpriteRotation: function(name) {\n        const sprite = this.sprites[name];\n        const spriteDiv = document.getElementById('sprite-' + name);\n        if (spriteDiv && sprite) {\n            spriteDiv.style.transform = 'rotate(' + (sprite.direction - 90) + 'deg)';\n        }\n    },\n\n    // Update sprite size in DOM\n    updateSpriteSize: function(name) {\n        const sprite = this.sprites[name];\n        const spriteDiv = document.getElementById('sprite-' + name);\n        if (spriteDiv && sprite) {\n            const scale = sprite.size / 100;\n            spriteDiv.style.transform = 'rotate(' + (sprite.direction - 90) + 'deg) scale(' + scale + ')';\n        }\n    },\n\n    // Show speech bubble\n    showSpeechBubble: function(spriteName, message, seconds, isThought) {\n        const sprite = this.sprites[spriteName];\n        const stageDiv = document.getElementById('stage');\n        if (!stageDiv || !sprite) return;\n\n        // Remove existing bubble\n        const existingBubble = document.getElementById('speech-' + spriteName);\n        if (existingBubble) existingBubble.remove();\n\n        // Create bubble\n        const bubble = document.createElement('div');\n        bubble.id = 'speech-' + spriteName;\n        bubble.style.position = 'absolute';\n        bubble.style.backgroundColor = 'white';\n        bubble.style.border = '2px solid black';\n        bubble.style.borderRadius = isThought ? '20px' : '10px';\n        bubble.style.padding = '8px 12px';\n        bubble.style.left = (sprite.x + this.stage.width/2 + 20) + 'px';\n        bubble.style.bottom = (sprite.y + this.stage.height/2 + 30) + 'px';\n        bubble.style.whiteSpace = 'nowrap';\n        bubble.style.zIndex = '100';\n        bubble.style.fontSize = '14px';\n        bubble.textContent = message;\n        stageDiv.appendChild(bubble);\n\n        console.log(spriteName + ' says: ' + message);\n\n        if (seconds) {\n            setTimeout(function() { bubble.remove(); }, seconds * 1000);\n        }\n    },\n\n    // Initialize the runtime\n    init: function() {\n        // Initialize default sprite\n        this.initSprite('Sprite1');\n        \n        // Setup UI when DOM is ready\n        const self = this;\n        const setupUI = function() {\n            const stageDiv = document.getElementById('stage');\n            if (stageDiv) {\n                // Use the actual rendered size of the stage (set by CSS flex)\n                // Store for coordinate calculations\n                const rect = stageDiv.getBoundingClientRect();\n                self.stage.width = rect.width || 480;\n                self.stage.height = rect.height || 360;\n                \n                stageDiv.style.backgroundColor = self.stage.backgroundColor;\n                stageDiv.style.position = 'relative';\n                stageDiv.style.overflow = 'hidden';\n\n                // Create sprite element\n                const spriteDiv = document.createElement('div');\n                spriteDiv.id = 'sprite-Sprite1';\n                spriteDiv.style.position = 'absolute';\n                spriteDiv.style.width = '30px';\n                spriteDiv.style.height = '30px';\n                spriteDiv.style.backgroundColor = '#ff6b6b';\n                spriteDiv.style.borderRadius = '50%';\n                spriteDiv.style.left = (self.stage.width/2 - 15) + 'px';\n                spriteDiv.style.bottom = (self.stage.height/2 - 15) + 'px';\n                spriteDiv.style.transform = 'rotate(0deg)';\n                spriteDiv.style.transition = 'left 0.05s, bottom 0.05s';\n                stageDiv.appendChild(spriteDiv);\n            }\n        };\n\n        if (document.readyState === 'loading') {\n            document.addEventListener('DOMContentLoaded', setupUI);\n        } else {\n            setupUI();\n        }\n\n        // Register keyboard event handlers\n        document.addEventListener('keydown', function(e) {\n            const keyEvent = 'keyPressed_' + e.key;\n            if (self.events[keyEvent] && Array.isArray(self.events[keyEvent])) {\n                self.events[keyEvent].forEach(function(callback) { callback(); });\n            }\n        });\n    },\n\n    // Register green flag handler\n    onGreenFlag: function(callback) {\n        this.greenFlagHandlers.push(callback);\n    },\n\n    // Trigger green flag\n    greenFlag: function() {\n        const self = this;\n        this.running = true;\n        console.log('ðŸš© Green flag clicked!');\n        this.greenFlagHandlers.forEach(function(handler) {\n            try {\n                handler();\n            } catch (e) {\n                console.error('Error in green flag handler:', e);\n            }\n        });\n    },\n\n    // Stop all scripts\n    stopAll: function() {\n        this.running = false;\n        console.log('ðŸ›‘ All scripts stopped');\n    },\n\n    // Broadcasting system\n    broadcast: function(message) {\n        console.log('ðŸ“¢ Broadcasting: ' + message);\n        if (this.broadcasts[message] && Array.isArray(this.broadcasts[message])) {\n            this.broadcasts[message].forEach(function(callback) { callback(); });\n        }\n    },\n\n    // Register a broadcast receiver\n    onBroadcast: function(message, callback) {\n        if (!this.broadcasts[message]) {\n            this.broadcasts[message] = [];\n        }\n        this.broadcasts[message].push(callback);\n    },\n\n    // Register an event handler\n    onEvent: function(event, callback) {\n        if (!this.events[event]) {\n            this.events[event] = [];\n        }\n        this.events[event].push(callback);\n    },\n\n    // Wait for seconds\n    wait: function(seconds) {\n        return new Promise(function(resolve) {\n            setTimeout(resolve, seconds * 1000);\n        });\n    },\n\n    // Ask a question and get an answer\n    ask: async function(question) {\n        const self = this;\n        return new Promise(function(resolve) {\n            const stageDiv = document.getElementById('stage');\n            if (!stageDiv) { resolve(''); return; }\n\n            const askDiv = document.createElement('div');\n            askDiv.id = 'ask-prompt';\n            askDiv.style.position = 'absolute';\n            askDiv.style.bottom = '10px';\n            askDiv.style.left = '10px';\n            askDiv.style.right = '10px';\n            askDiv.style.backgroundColor = 'white';\n            askDiv.style.border = '2px solid black';\n            askDiv.style.borderRadius = '8px';\n            askDiv.style.padding = '10px';\n            askDiv.style.zIndex = '200';\n\n            const questionText = document.createElement('div');\n            questionText.textContent = question;\n            questionText.style.marginBottom = '8px';\n            askDiv.appendChild(questionText);\n\n            const inputField = document.createElement('input');\n            inputField.type = 'text';\n            inputField.style.width = 'calc(100% - 70px)';\n            inputField.style.padding = '5px';\n            inputField.style.border = '1px solid #ccc';\n            inputField.style.borderRadius = '4px';\n            askDiv.appendChild(inputField);\n\n            const submitButton = document.createElement('button');\n            submitButton.textContent = 'âœ“';\n            submitButton.style.marginLeft = '5px';\n            submitButton.style.padding = '5px 15px';\n            submitButton.style.backgroundColor = '#4CAF50';\n            submitButton.style.color = 'white';\n            submitButton.style.border = 'none';\n            submitButton.style.borderRadius = '4px';\n            submitButton.style.cursor = 'pointer';\n            askDiv.appendChild(submitButton);\n\n            const submit = function() {\n                self.answer = inputField.value;\n                askDiv.remove();\n                resolve(self.answer);\n            };\n\n            submitButton.onclick = submit;\n            inputField.addEventListener('keypress', function(e) {\n                if (e.key === 'Enter') submit();\n            });\n\n            stageDiv.appendChild(askDiv);\n            inputField.focus();\n        });\n    }\n};\n\n// Initialize the runtime\nscratchRuntime.init();\n// Variables\n// No variables defined\n\n// Lists\n// No lists defined\n\n// Custom Procedures\n// No procedures defined\n\n// Scripts\n// Script 1\n// When green flag clicked\nscratchRuntime.onGreenFlag(async function() {\n    scratchRuntime.sprites[scratchRuntime.currentSprite].say(\"hi\");\n});\n\n\n",
      "html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Scratch Preview</title>\n    <style>\n        * {\n            box-sizing: border-box;\n            margin: 0;\n            padding: 0;\n        }\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            background-color: #f0f0f0;\n            height: 100vh;\n            display: flex;\n            flex-direction: column;\n        }\n        \n        .stage-container {\n            flex: 1;\n            display: flex;\n            flex-direction: column;\n            padding: 8px;\n            gap: 8px;\n        }\n        \n        .controls {\n            display: flex;\n            gap: 6px;\n            align-items: center;\n        }\n        \n        .flag-btn {\n            width: 36px;\n            height: 36px;\n            border: none;\n            border-radius: 4px;\n            cursor: pointer;\n            font-size: 20px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            background-color: #4CAF50;\n            transition: all 0.15s;\n        }\n        .flag-btn:hover {\n            background-color: #45a049;\n            transform: scale(1.05);\n        }\n        .flag-btn:active {\n            transform: scale(0.95);\n        }\n        \n        .stop-btn {\n            width: 36px;\n            height: 36px;\n            border: none;\n            border-radius: 4px;\n            cursor: pointer;\n            font-size: 20px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            background-color: #e53935;\n            transition: all 0.15s;\n        }\n        .stop-btn:hover {\n            background-color: #c62828;\n            transform: scale(1.05);\n        }\n        .stop-btn:active {\n            transform: scale(0.95);\n        }\n        \n        #stage {\n            flex: 1;\n            background-color: white;\n            border: 2px solid #d0d0d0;\n            border-radius: 8px;\n            position: relative;\n            overflow: hidden;\n            min-height: 200px;\n        }\n        \n        #console {\n            height: 100px;\n            border: 1px solid #d0d0d0;\n            border-radius: 6px;\n            padding: 6px 8px;\n            overflow-y: auto;\n            font-family: 'Monaco', 'Menlo', 'Consolas', monospace;\n            font-size: 11px;\n            background-color: #1a1a2e;\n            color: #eee;\n        }\n        \n        #console:empty::before {\n            content: 'Console...';\n            color: #555;\n        }\n        \n        .log-line {\n            padding: 1px 0;\n            border-bottom: 1px solid #2a2a3e;\n        }\n        .log-line:last-child {\n            border-bottom: none;\n        }\n        .log-line.say {\n            color: #4fc3f7;\n        }\n        .log-line.flag {\n            color: #81c784;\n        }\n        .log-line.stop {\n            color: #e57373;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"stage-container\">\n        <div class=\"controls\">\n            <button id=\"flag-btn\" class=\"flag-btn\" title=\"Green Flag - Start\">ðŸš©</button>\n            <button id=\"stop-btn\" class=\"stop-btn\" title=\"Stop and Reset\">ðŸ›‘</button>\n        </div>\n        <div id=\"stage\"></div>\n        <div id=\"console\"></div>\n    </div>\n\n    <script>\n        // Console logging override\n        const originalLog = console.log;\n        const originalError = console.error;\n        \n        function log(msg, cls) {\n            const c = document.getElementById('console');\n            if (c) {\n                const line = document.createElement('div');\n                line.className = 'log-line' + (cls ? ' ' + cls : '');\n                line.textContent = msg;\n                c.appendChild(line);\n                c.scrollTop = c.scrollHeight;\n            }\n        }\n        \n        console.log = function() {\n            originalLog.apply(console, arguments);\n            const msg = Array.from(arguments).join(' ');\n            let cls = '';\n            if (msg.includes('says:')) cls = 'say';\n            else if (msg.includes('ðŸš©')) cls = 'flag';\n            else if (msg.includes('ðŸ›‘')) cls = 'stop';\n            log(msg, cls);\n        };\n        \n        console.error = function() {\n            originalError.apply(console, arguments);\n            log('Error: ' + Array.from(arguments).join(' '), 'stop');\n        };\n        \n        // Green Flag button\n        document.getElementById('flag-btn').addEventListener('click', function() {\n            document.getElementById('console').innerHTML = '';\n            if (typeof scratchRuntime !== 'undefined') {\n                scratchRuntime.greenFlag();\n            }\n        });\n        \n        // Stop button (also resets)\n        document.getElementById('stop-btn').addEventListener('click', function() {\n            if (typeof scratchRuntime !== 'undefined') {\n                scratchRuntime.stopAll();\n            }\n            // Reset by reloading\n            setTimeout(function() { location.reload(); }, 100);\n        });\n        \n        // Generated program code\n        // Generated Scratch-like JavaScript code\n// Runtime support functions\nconst scratchRuntime = {\n    sprites: {},\n    stage: { width: 480, height: 360, backgroundColor: 'white' },\n    currentSprite: 'Sprite1',\n    variables: {},\n    lists: {},\n    procedures: {},\n    events: {},\n    greenFlagHandlers: [],\n    answer: '',\n    broadcasts: {},\n    running: false,\n\n    // Initialize the default sprite\n    initSprite: function(name) {\n        this.sprites[name] = {\n            x: 0,\n            y: 0,\n            direction: 90,\n            visible: true,\n            size: 100,\n            move: function(steps) {\n                const radians = (this.direction - 90) * Math.PI / 180;\n                this.x += steps * Math.cos(radians);\n                this.y -= steps * Math.sin(radians);\n                scratchRuntime.updateSpritePosition(name);\n            },\n            turnRight: function(degrees) {\n                this.direction = (this.direction + degrees) % 360;\n                scratchRuntime.updateSpriteRotation(name);\n            },\n            turnLeft: function(degrees) {\n                this.direction = (this.direction - degrees + 360) % 360;\n                scratchRuntime.updateSpriteRotation(name);\n            },\n            pointInDirection: function(dir) {\n                this.direction = dir % 360;\n                if (this.direction < 0) this.direction += 360;\n                scratchRuntime.updateSpriteRotation(name);\n            },\n            goTo: function(x, y) {\n                this.x = x;\n                this.y = y;\n                scratchRuntime.updateSpritePosition(name);\n            },\n            setX: function(x) {\n                this.x = x;\n                scratchRuntime.updateSpritePosition(name);\n            },\n            setY: function(y) {\n                this.y = y;\n                scratchRuntime.updateSpritePosition(name);\n            },\n            changeX: function(dx) {\n                this.x += dx;\n                scratchRuntime.updateSpritePosition(name);\n            },\n            changeY: function(dy) {\n                this.y += dy;\n                scratchRuntime.updateSpritePosition(name);\n            },\n            hide: function() {\n                this.visible = false;\n                const spriteDiv = document.getElementById('sprite-' + name);\n                if (spriteDiv) spriteDiv.style.display = 'none';\n            },\n            show: function() {\n                this.visible = true;\n                const spriteDiv = document.getElementById('sprite-' + name);\n                if (spriteDiv) spriteDiv.style.display = 'block';\n            },\n            setSize: function(size) {\n                this.size = size;\n                scratchRuntime.updateSpriteSize(name);\n            },\n            changeSize: function(change) {\n                this.size += change;\n                scratchRuntime.updateSpriteSize(name);\n            },\n            say: function(message, seconds) {\n                scratchRuntime.showSpeechBubble(name, message, seconds);\n            },\n            think: function(message, seconds) {\n                scratchRuntime.showSpeechBubble(name, message, seconds, true);\n            }\n        };\n    },\n\n    // Update sprite position in DOM\n    updateSpritePosition: function(name) {\n        const sprite = this.sprites[name];\n        const spriteDiv = document.getElementById('sprite-' + name);\n        if (spriteDiv && sprite) {\n            spriteDiv.style.left = (sprite.x + this.stage.width/2 - 15) + 'px';\n            spriteDiv.style.bottom = (sprite.y + this.stage.height/2 - 15) + 'px';\n        }\n    },\n\n    // Update sprite rotation in DOM\n    updateSpriteRotation: function(name) {\n        const sprite = this.sprites[name];\n        const spriteDiv = document.getElementById('sprite-' + name);\n        if (spriteDiv && sprite) {\n            spriteDiv.style.transform = 'rotate(' + (sprite.direction - 90) + 'deg)';\n        }\n    },\n\n    // Update sprite size in DOM\n    updateSpriteSize: function(name) {\n        const sprite = this.sprites[name];\n        const spriteDiv = document.getElementById('sprite-' + name);\n        if (spriteDiv && sprite) {\n            const scale = sprite.size / 100;\n            spriteDiv.style.transform = 'rotate(' + (sprite.direction - 90) + 'deg) scale(' + scale + ')';\n        }\n    },\n\n    // Show speech bubble\n    showSpeechBubble: function(spriteName, message, seconds, isThought) {\n        const sprite = this.sprites[spriteName];\n        const stageDiv = document.getElementById('stage');\n        if (!stageDiv || !sprite) return;\n\n        // Remove existing bubble\n        const existingBubble = document.getElementById('speech-' + spriteName);\n        if (existingBubble) existingBubble.remove();\n\n        // Create bubble\n        const bubble = document.createElement('div');\n        bubble.id = 'speech-' + spriteName;\n        bubble.style.position = 'absolute';\n        bubble.style.backgroundColor = 'white';\n        bubble.style.border = '2px solid black';\n        bubble.style.borderRadius = isThought ? '20px' : '10px';\n        bubble.style.padding = '8px 12px';\n        bubble.style.left = (sprite.x + this.stage.width/2 + 20) + 'px';\n        bubble.style.bottom = (sprite.y + this.stage.height/2 + 30) + 'px';\n        bubble.style.whiteSpace = 'nowrap';\n        bubble.style.zIndex = '100';\n        bubble.style.fontSize = '14px';\n        bubble.textContent = message;\n        stageDiv.appendChild(bubble);\n\n        console.log(spriteName + ' says: ' + message);\n\n        if (seconds) {\n            setTimeout(function() { bubble.remove(); }, seconds * 1000);\n        }\n    },\n\n    // Initialize the runtime\n    init: function() {\n        // Initialize default sprite\n        this.initSprite('Sprite1');\n        \n        // Setup UI when DOM is ready\n        const self = this;\n        const setupUI = function() {\n            const stageDiv = document.getElementById('stage');\n            if (stageDiv) {\n                // Use the actual rendered size of the stage (set by CSS flex)\n                // Store for coordinate calculations\n                const rect = stageDiv.getBoundingClientRect();\n                self.stage.width = rect.width || 480;\n                self.stage.height = rect.height || 360;\n                \n                stageDiv.style.backgroundColor = self.stage.backgroundColor;\n                stageDiv.style.position = 'relative';\n                stageDiv.style.overflow = 'hidden';\n\n                // Create sprite element\n                const spriteDiv = document.createElement('div');\n                spriteDiv.id = 'sprite-Sprite1';\n                spriteDiv.style.position = 'absolute';\n                spriteDiv.style.width = '30px';\n                spriteDiv.style.height = '30px';\n                spriteDiv.style.backgroundColor = '#ff6b6b';\n                spriteDiv.style.borderRadius = '50%';\n                spriteDiv.style.left = (self.stage.width/2 - 15) + 'px';\n                spriteDiv.style.bottom = (self.stage.height/2 - 15) + 'px';\n                spriteDiv.style.transform = 'rotate(0deg)';\n                spriteDiv.style.transition = 'left 0.05s, bottom 0.05s';\n                stageDiv.appendChild(spriteDiv);\n            }\n        };\n\n        if (document.readyState === 'loading') {\n            document.addEventListener('DOMContentLoaded', setupUI);\n        } else {\n            setupUI();\n        }\n\n        // Register keyboard event handlers\n        document.addEventListener('keydown', function(e) {\n            const keyEvent = 'keyPressed_' + e.key;\n            if (self.events[keyEvent] && Array.isArray(self.events[keyEvent])) {\n                self.events[keyEvent].forEach(function(callback) { callback(); });\n            }\n        });\n    },\n\n    // Register green flag handler\n    onGreenFlag: function(callback) {\n        this.greenFlagHandlers.push(callback);\n    },\n\n    // Trigger green flag\n    greenFlag: function() {\n        const self = this;\n        this.running = true;\n        console.log('ðŸš© Green flag clicked!');\n        this.greenFlagHandlers.forEach(function(handler) {\n            try {\n                handler();\n            } catch (e) {\n                console.error('Error in green flag handler:', e);\n            }\n        });\n    },\n\n    // Stop all scripts\n    stopAll: function() {\n        this.running = false;\n        console.log('ðŸ›‘ All scripts stopped');\n    },\n\n    // Broadcasting system\n    broadcast: function(message) {\n        console.log('ðŸ“¢ Broadcasting: ' + message);\n        if (this.broadcasts[message] && Array.isArray(this.broadcasts[message])) {\n            this.broadcasts[message].forEach(function(callback) { callback(); });\n        }\n    },\n\n    // Register a broadcast receiver\n    onBroadcast: function(message, callback) {\n        if (!this.broadcasts[message]) {\n            this.broadcasts[message] = [];\n        }\n        this.broadcasts[message].push(callback);\n    },\n\n    // Register an event handler\n    onEvent: function(event, callback) {\n        if (!this.events[event]) {\n            this.events[event] = [];\n        }\n        this.events[event].push(callback);\n    },\n\n    // Wait for seconds\n    wait: function(seconds) {\n        return new Promise(function(resolve) {\n            setTimeout(resolve, seconds * 1000);\n        });\n    },\n\n    // Ask a question and get an answer\n    ask: async function(question) {\n        const self = this;\n        return new Promise(function(resolve) {\n            const stageDiv = document.getElementById('stage');\n            if (!stageDiv) { resolve(''); return; }\n\n            const askDiv = document.createElement('div');\n            askDiv.id = 'ask-prompt';\n            askDiv.style.position = 'absolute';\n            askDiv.style.bottom = '10px';\n            askDiv.style.left = '10px';\n            askDiv.style.right = '10px';\n            askDiv.style.backgroundColor = 'white';\n            askDiv.style.border = '2px solid black';\n            askDiv.style.borderRadius = '8px';\n            askDiv.style.padding = '10px';\n            askDiv.style.zIndex = '200';\n\n            const questionText = document.createElement('div');\n            questionText.textContent = question;\n            questionText.style.marginBottom = '8px';\n            askDiv.appendChild(questionText);\n\n            const inputField = document.createElement('input');\n            inputField.type = 'text';\n            inputField.style.width = 'calc(100% - 70px)';\n            inputField.style.padding = '5px';\n            inputField.style.border = '1px solid #ccc';\n            inputField.style.borderRadius = '4px';\n            askDiv.appendChild(inputField);\n\n            const submitButton = document.createElement('button');\n            submitButton.textContent = 'âœ“';\n            submitButton.style.marginLeft = '5px';\n            submitButton.style.padding = '5px 15px';\n            submitButton.style.backgroundColor = '#4CAF50';\n            submitButton.style.color = 'white';\n            submitButton.style.border = 'none';\n            submitButton.style.borderRadius = '4px';\n            submitButton.style.cursor = 'pointer';\n            askDiv.appendChild(submitButton);\n\n            const submit = function() {\n                self.answer = inputField.value;\n                askDiv.remove();\n                resolve(self.answer);\n            };\n\n            submitButton.onclick = submit;\n            inputField.addEventListener('keypress', function(e) {\n                if (e.key === 'Enter') submit();\n            });\n\n            stageDiv.appendChild(askDiv);\n            inputField.focus();\n        });\n    }\n};\n\n// Initialize the runtime\nscratchRuntime.init();\n// Variables\n// No variables defined\n\n// Lists\n// No lists defined\n\n// Custom Procedures\n// No procedures defined\n\n// Scripts\n// Script 1\n// When green flag clicked\nscratchRuntime.onGreenFlag(async function() {\n    scratchRuntime.sprites[scratchRuntime.currentSprite].say(\"hi\");\n});\n\n\n\n    </script>\n</body>\n</html>"
    }
  }
]